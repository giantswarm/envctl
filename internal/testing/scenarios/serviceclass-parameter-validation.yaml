name: "serviceclass-parameter-validation-scenarios"
category: "behavioral"
concept: "serviceclass"
description: "Scenarios for ServiceClass parameter validation"
tags: ["serviceclass", "parameters", "validation", "core-api"]
timeout: "7m"

pre_configuration:
  service_classes:
    - name: "param-validation-sc"
      config:
        name: "param-validation-sc"
        type: "basic"
        parameters:
          string_param:
            type: "string"
            description: "A string parameter"
            required: true
          int_param:
            type: "integer"
            description: "An integer parameter"
            default: 10
          bool_param:
            type: "boolean"
            description: "A boolean parameter"
            default: false
        serviceConfig:
          lifecycleTools:
            start: { tool: "core_service_list" }

steps:
- id: "create-service-with-all-params"
  description: "Create a service instance providing all parameters"
  tool: "core_service_create"
  args:
    serviceClassName: "param-validation-sc"
    label: "service-all-params"
    parameters:
      string_param: "hello"
      int_param: 20
      bool_param: true
  expected:
    success: true
  cleanup:
  - tool: "core_service_delete"
    args: { labelOrServiceId: "service-all-params" }

- id: "create-service-with-default-params"
  description: "Create a service instance relying on default parameters"
  tool: "core_service_create"
  args:
    serviceClassName: "param-validation-sc"
    label: "service-default-params"
    parameters:
      string_param: "world"
  expected:
    success: true
  cleanup:
  - tool: "core_service_delete"
    args: { labelOrServiceId: "service-default-params" }

- id: "create-service-missing-required-param"
  description: "Attempt to create a service missing a required parameter"
  tool: "core_service_create"
  args:
    serviceClassName: "param-validation-sc"
    label: "service-missing-param"
    parameters:
      int_param: 5
  expected:
    success: false
    error_contains: ["missing required parameter: string_param"]

- id: "create-service-with-wrong-param-type-string"
  description: "Attempt to create a service with the wrong type for a string parameter"
  tool: "core_service_create"
  args:
    serviceClassName: "param-validation-sc"
    label: "service-wrong-type-string"
    parameters:
      string_param: 12345
  expected:
    success: false
    error_contains: ["invalid type for parameter 'string_param'"]

- id: "create-service-with-wrong-param-type-int"
  description: "Attempt to create a service with the wrong type for an integer parameter"
  tool: "core_service_create"
  args:
    serviceClassName: "param-validation-sc"
    label: "service-wrong-type-int"
    parameters:
      string_param: "hello"
      int_param: "not-an-int"
  expected:
    success: false
    error_contains: ["invalid type for parameter 'int_param'"]

- id: "create-service-with-wrong-param-type-bool"
  description: "Attempt to create a service with the wrong type for a boolean parameter"
  tool: "core_service_create"
  args:
    serviceClassName: "param-validation-sc"
    label: "service-wrong-type-bool"
    parameters:
      string_param: "hello"
      bool_param: "not-a-bool"
  expected:
    success: false
    error_contains: ["invalid type for parameter 'bool_param'"]

- id: "create-service-with-extra-param"
  description: "Attempt to create a service with an undefined parameter"
  tool: "core_service_create"
  args:
    serviceClassName: "param-validation-sc"
    label: "service-extra-param"
    parameters:
      string_param: "hello"
      extra_param: "this should be ignored or fail"
  expected:
    success: false
    error_contains: ["unknown parameter: extra_param"] 