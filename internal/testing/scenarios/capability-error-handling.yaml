name: "capability-error-handling-scenarios"
category: "behavioral"
concept: "capability"
description: "Error handling for Capability management"
tags: ["capability", "error-handling", "core-api"]
timeout: "5m"

steps:
- id: "create-capability-missing-name"
  description: "Attempt to create a capability with a missing 'name' field"
  tool: "core_capability_create"
  args:
    type: "test"
    description: "This capability is missing a name"
    operations:
      test_operation:
        description: "A test operation"
        requires: []
  expected:
    success: false
    error_contains: ["name parameter is required"]

- id: "create-capability-missing-type"
  description: "Attempt to create a capability with a missing 'type' field"
  tool: "core_capability_create"
  args:
    name: "missing-type-cap"
    description: "This capability is missing a type"
    operations:
      test_operation:
        description: "A test operation"
        requires: []
  expected:
    success: false
    error_contains: ["type parameter is required"]

- id: "create-capability-missing-operations"
  description: "Attempt to create a capability with missing operations"
  tool: "core_capability_create"
  args:
    name: "missing-ops-cap"
    type: "test"
    description: "This capability has no operations"
    operations: {}
  expected:
    success: false
    error_contains: ["must have at least one operation"]

- id: "create-capability-with-conflicting-name"
  description: "Create a capability, then try to create another with the same name"
  tool: "core_capability_create"
  args:
    name: "conflicting-cap"
    type: "test"
    operations:
      test_operation:
        description: "A test operation"
        requires: []
  expected:
    success: true
  cleanup:
  - tool: "core_capability_delete"
    args: { name: "conflicting-cap" }

- id: "create-conflicting-capability-step-2"
  description: "Attempt the conflicting creation"
  tool: "core_capability_create"
  args:
    name: "conflicting-cap"
    type: "another-test"
    operations:
      test_operation:
        description: "Another test operation"
        requires: []
  expected:
    success: false
    error_contains: ["already exists"]

- id: "get-non-existent-capability"
  description: "Attempt to get a capability that does not exist"
  tool: "core_capability_get"
  args:
    name: "non-existent-capability"
  expected:
    success: false
    error_contains: ["not found"]

- id: "update-non-existent-capability"
  description: "Attempt to update a non-existent capability"
  tool: "core_capability_update"
  args:
    name: "non-existent-capability"
    description: "Updated description"
  expected:
    success: false
    error_contains: ["not found"]

- id: "delete-non-existent-capability"
  description: "Attempt to delete a non-existent capability"
  tool: "core_capability_delete"
  args:
    name: "non-existent-capability"
  expected:
    success: false
    error_contains: ["not found"] 