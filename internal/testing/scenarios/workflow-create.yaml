name: "workflow-create"
category: "behavioral"
concept: "workflow"
description: "Tests creating a valid workflow definition."
tags: ["workflow", "create", "core-api"]
timeout: "1m"

pre_configuration:
  mcp_servers:
    - name: "workflow-test-provider"
      config:
        tools:
          - name: "test_action"
            input_schema: { type: "object", properties: { message: { type: "string" } } }
            responses: [{ response: { result: "success" } }]

steps:
- id: "create-valid-workflow"
  description: "Create a new workflow with valid structure"
  tool: "core_workflow_create"
  args:
    name: "test-workflow"
    description: "A test workflow for validation"
    icon: "üöÄ"
    agentModifiable: true
    createdBy: "test-user"
    version: 1
    inputSchema:
      type: "object"
      properties:
        message:
          type: "string"
          description: "Input message for the workflow"
      required: ["message"]
    steps:
      - id: "step1"
        tool: "x_workflow-test-provider_test_action"
        args:
          message: "{{ .input.message }}"
        store: "step1_result"
  expected:
    success: true
  cleanup:
    - id: "delete-created-workflow"
      tool: "core_workflow_delete"
      args:
        name: "test-workflow"

- id: "verify-workflow-in-list"
  description: "Verify the new workflow appears in the list"
  tool: "core_workflow_list"
  expected:
    success: true
    contains: ["test-workflow"]

- id: "create-advanced-workflow"
  description: "Create a more complex workflow with multiple steps and dependencies"
  tool: "core_workflow_create"
  args:
    name: "advanced-test-workflow"
    description: "An advanced test workflow with multiple steps"
    icon: "‚öôÔ∏è"
    agentModifiable: false
    createdBy: "test-admin"
    version: 2
    inputSchema:
      type: "object"
      properties:
        count:
          type: "number"
          description: "Number of iterations"
          default: 3
        prefix:
          type: "string" 
          description: "Prefix for messages"
      required: ["prefix"]
    steps:
      - id: "init"
        tool: "x_workflow-test-provider_test_action"
        args:
          message: "Initializing with {{ .input.prefix }}"
        store: "init_result"
      - id: "process"
        tool: "x_workflow-test-provider_test_action"
        args:
          message: "Processing {{ .input.count }} items with prefix {{ .input.prefix }}"
        store: "process_result"
      - id: "finalize"
        tool: "x_workflow-test-provider_test_action"
        args:
          message: "Finalizing workflow, init: {{ .step1_result }}, process: {{ .process_result }}"
  expected:
    success: true
  cleanup:
    - id: "delete-advanced-workflow"
      tool: "core_workflow_delete"
      args:
        name: "advanced-test-workflow" 